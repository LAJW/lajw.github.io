<!DOCTYPE html><html><head><link rel="icon" href="/favicon.png"><meta charset="UTF-8"><title>MARK1 - Data Viewer</title><style>body,h1,h3,input,p{padding:0;margin:0;border:0;font-family:"Segoe UI", sans;font-size:12pt}body{background:#000;color:#fff}a:link,a:visited{color:#fff}a{text-decoration:none}#resources{display:none}#categories{z-index:1001;background:rgba(30,30,30,.6);position:absolute;left:0;top:0;height:52px;right:300px}#categories a{display:inline-block;padding:15px;width:170px;height:22px; line-height:22px;}#data{z-index:1001;position:absolute;right:0;top:0;bottom:0;width:290px;padding:5px;overflow:auto;background:rgba(60,60,60,.6)}#data h3{font-weight:400;font-size:14pt;padding-bottom:5px;margin-bottom:5px;border-bottom:1px solid #999}#data span{display:block;padding:5px;margin-bottom:5px}#data label{display:inline-block;width:50%}#data a,#data input{display:inline-block;padding:0 5px;width:120px;margin-bottom:5px;color:#000;overflow:hidden;vertical-align:middle}#data a{white-space:nowrap;background:#e00;color:#fff}#selector{z-index:1001;position:absolute;top:52px;left:0;bottom:0;width:200px;overflow:auto;background:rgba(60,60,60,.6)}#selector a{display:block;padding:15px}#categories a.active,#categories a:hover,#selector a.active,#selector a:hover{background:#d00}#canvas{background:#555;display:block;position:absolute;top:0;left:0;right:0;bottom:0;vertical-align:top;z-index:1000}#error-box{width:400px;top:300px;position:absolute;left:350px;border:3px ridge #ccc;background:#555;color:#aaa;display:none}#error-box h1{background:url(data/sprite-error-box.png);padding:15px;margin-bottom:15px;border-bottom:3px #aaa ridge;color:#d33;text-shadow:0 0 5px #000;font-size:16pt;text-transform:uppercase}#error-box p{font-size:12pt;padding:0 15px 15px}#foot{z-index:1001;font-size:9pt;bottom:0;left:200px;right:300px;position:absolute;text-align:right}#categories a.home:link,#categories a.home:visited, #categories a.home:hover{background: #902dff url('../home.png') no-repeat 10px center;padding-left:50px; width:135px}</style><script>function sin(e){return Math.sin(e*Math.PI/180)}function cos(e){return Math.cos(e*Math.PI/180)}function toNumber(e){return parseFloat(e||0)}function angularDiff(e,t){var n=e-t;n+=n>180?-360:n<-180?360:0;return n}function confine(e,t,n){return e<t?t:e>n?n:e}function sgn(e){return e>0?1:e<0?-1:0}function genericClone(){return new this.constructor(this)}function _static(e){for(var t in e)this[t]=e[t];return this}function Class(){var e=arguments[arguments.length-1];if(e.constructor===Object.prototype.constructor)e.constructor=function(){};var t=e.constructor;var n={clone:genericClone};t.static=_static;for(var r=0,i=arguments.length-1;r<i;r++){var s=new arguments[r];for(var o in s)n[o]=s[o]}for(var r in e)n[r]=e[r];t.prototype=n;return t}function Exception(e){return Class(Error,{constructor:function(t){this.name=e;this.message=t},toString:function(){return"Exception ["+this.name+"]: "+this.message}})}Array.prototype.clone=function(){var e=[];for(var t=0,n=this.length;t<n;t++)e.push(this[t].clone());return e};World=Class({constructor:function(){this.objects=[];this.paused=false},push:function(e){e.attachWorld(this);this.objects.push(e)},tick:function(e,t){if(!this.paused){for(var n=0;n<this.objects.length;n++){if(this.objects[n].dead){this.objects.splice(n,1);n--}else{this.objects[n].tick(e,t)}}}}});Point=Class({constructor:function(e,t){if(e&&isNaN(e)){this.x=e.x;this.y=e.y}else{this.x=e||0;this.y=t||0}},set:function(e,t){this.x=e;this.y=t},plus:function(e){return new Point(this.x+e.x,this.y+e.y)},minus:function(e){return new Point(this.x-e.x,this.y-e.y)},multiply:function(e){return new Point(this.x*e,this.y*e)},divide:function(e){return new Point(this.x/e,this.y/e)},rotate:function(e){var t=cos(e);var n=sin(e);return new Point(this.x*t-this.y*n,this.x*n+this.y*t)},getAngle:function(){return Math.atan2(this.y,this.x)*180/Math.PI},normalize:function(){return this.divide(this.length())},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}});var A="A".charCodeAt(0);var Z="Z".charCodeAt(0);var _0="0".charCodeAt(0);var _9="9".charCodeAt(0);KeyMap={up:0,down:0,left:0,right:0,shoot:0,zoomIn:0,zoomOut:0,keydown:function(e){KeyMap.handleEvent("keydown",e)},keyup:function(e){KeyMap.handleEvent("keyup",e)},handleEvent:function(e,t){var n=t.keyCode;var r=e=="keydown"?1:0;if(n>=A&&n<=Z||n>=_0&&n<=_9)n=String.fromCharCode(n);switch(n){case"W":KeyMap["up"]=r;break;case"S":KeyMap["down"]=r;break;case"A":KeyMap["left"]=r;break;case"D":KeyMap["right"]=r;break;case 32:KeyMap["shoot"]=r;break;case 107:KeyMap["zoomIn"]=r;break;case 109:KeyMap["zoomOut"]=r;break}}};Matrix=Class({constructor:function(e,t,n,r,i,s){this._11=e;this._12=t;this._21=n;this._22=r;this._31=i;this._32=s},clone:function(){return new Matrix(this._11,this._12,this._21,this._22,this._31,this._32)},multiply:function(e){var t=this,n=e;var r=t._11*n._11+t._12*n._21;var i=t._11*n._12+t._12*n._22;var s=t._21*n._11+t._22*n._21;var o=t._21*n._12+t._22*n._22;var u=t._31*n._11+t._32*n._21+n._31;var a=t._31*n._12+t._32*n._22+n._32;return new Matrix(r,i,s,o,u,a)},translate:function(e){var t=this.clone();t._31+=e.x;t._32+=e.y;return t},translate2:function(e,t){var n=this.clone();n._31+=e;n._32+=t;return n},scale:function(e){return this.multiply(new Matrix.scale(e))},scale2:function(e,t){return this.multiply(new Matrix.scale2(e,t))},rotate:function(e){return this.multiply(new Matrix.rotation(e))}});Matrix.static({translation:function(e){return new Matrix(1,0,0,1,e.x,e.y)},translation2:function(e,t){return new Matrix(1,0,0,1,e,t)},identity:function(){return new Matrix(1,0,0,1,0,0)},scale:function(e){return new Matrix(e,0,0,e,0,0)},scale2:function(e,t){return new Matrix(e,0,0,t,0,0)},rotation:function(e){var t=cos(e);var n=sin(e);return new Matrix(t,n,-n,t,0,0)}});RenderTarget=Class({constructor:function(e,t){if(isNaN(t)||t<1)t=1;this.canvas=document.getElementById(e);this.context=canvas.getContext("2d");this.layers=[];this.globalAlpha=1;this.globalTransform=Matrix.identity();for(var n=0;n<t;n++){this.layers.push([])}this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight},clone:null,setGlobalTransform:function(e){this.globalTransform=e},render:function(e,t,n,r,i){this.layers[t].push({sprite:e,frame:n,transform:r,alpha:i})},draw:function(e,t){this.layers[e].push(t)},swap:function(){this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=0;e<this.layers.length;e++){var t=this.layers[e];for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i.sprite){var s=i.sprite.width,o=i.sprite.height,u=this.globalTransform.multiply(i.transform);var a=i.sprite.frames[i.frame];this.context.globalAlpha=i.alpha;this.context.setTransform(u._11,u._12,u._21,u._22,u._31,u._32);this.context.drawImage(i.sprite.resource,a.x,a.y,s,o,-s/2,-o/2,s,o)}else{this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=i.color||"#fff";this.context.lineWidth=i.width||1;for(var f=0,l=i.length;f<l;f++){var c=i[f];this.context.globalAlpha=c.alpha;this.context.beginPath();this.context.moveTo(c.start.x,c.start.y);this.context.lineTo(c.end.x,c.end.y);this.context.stroke()}}}this.layers[e]=[]}},getSize:function(){return new Point(this.canvas.width,this.canvas.height)},getCursor:function(){return new Point(Model.cursor.x-this.canvas.offsetLeft,Model.cursor.y-this.canvas.offsetTop)},onClick:function(e){this.canvas.onclick=e}});window.onkeydown=KeyMap.keydown;window.onkeyup=KeyMap.keyup;var cursor=new Point(0,0);window.onmousemove=function(e){var t=(window.pageXOffset||document.documentElement.scrollLeft)+(e.clientX||e.pageX);var n=(window.pageYOffset||document.documentElement.scrollTop)+(e.clientY||e.pageY);Model.cursor.set(t,n)};Model={cursor:new Point(0,0),Exception:Exception("Model"),loadXML:function(e){var t=new XMLHttpRequest;t.open("GET",e,false);t.send();if(!t.responseXML)throw new Model.Exception("Invalid XML Data.");return t.responseXML.childNodes[0]},loadIMG:function(e){var t=document.getElementById("resources").childNodes;for(var n=0,r=t.length;n<r;n++)if(t[n].src==e)return t[n];var i=document.createElement("IMG");i.src="data/"+e;return document.getElementById("resources").appendChild(i)},getCookie:function(e){var t=e+"=";var n=document.cookie.split(";");for(var r=0;r<n.length;r++){var i=n[r];while(i.charAt(0)==" ")i=i.substring(1);if(i.indexOf(t)!=-1)return i.substring(t.length,i.length)}return""},setCookie:function(e,t,n){var r=new Date;r.setTime(r.getTime()+n*24*60*60*1e3);var i="expires="+r.toUTCString();document.cookie=e+"="+t+"; "+i},getValue:function(e){var t=window.location.hash.substr(1).split("&");for(var n=0,r=t.length;n<r;n++){var i=t[n].split("=");if(i[0]==e)return i[1]}return null},setData:function(e){var t=document.getElementById("data");t.innerHTML="";for(var n=0,r=e.length;n<r;n++){var i=e[n];var s=document.createElement("span");for(var o in i){var u=i[o];if(o=="name"){var a=document.createElement("h3");a.innerHTML=u;s.appendChild(a)}else if(o=="desc"){var f=document.createElement("p");f.innerHTML=(u||"").replace(/\n/g,"<br>");s.appendChild(f)}else{var l=document.createElement("label");l.innerHTML=o;s.appendChild(l);if(u&&u.href){var c=document.createElement("a");c.innerHTML=u.name;c.href=u.href;s.appendChild(c)}else{var h=document.createElement("input");h.disabled=true;h.value=u;s.appendChild(h)}}}t.appendChild(s)}},setValue:function(e,t){var n=document.getElementById(e);if(!n)throw new Model.Exception("Element not found, id: "+e);n.innerHTML="";var r=false;for(var i=0,s=t.length;i<s;i++){var o=document.createElement("a");o.innerHTML=t[i].name;o.href=t[i].href;if(t[i].active){o.className="active";r=true}n.appendChild(o)}if(!r&&n.firstChild){n.firstChild.className="active"}},errorBox:function(e){var t=document.getElementById("error-box");if(t){t.style.display="block";t.innerHTML="<h1>"+e.name+" error</h1><p>"+e.message+"</p>"}else alert(e.name+"\r\n"+e.message)},onLoad:function(e){if(document.body)e();window.onload=function(){if(document.body){e();window.onload=null}}}};WorldObject=Class({constructor:function(e){this.modules=[];if(e){if(!e.nodeName){var t=e;this.world=t.world;for(var n=0,r=t.modules.length;n<r;n++){var i=t.modules[n].clone();i.attachParent(this);this.modules.push(i)}}else if(e){for(var n=0,r=e.childNodes.length;n<r;n++){var s=e.childNodes[n];var i=null;switch(s.nodeName){case"sticker":i=new Sticker(s);break;case"tracer":i=new Tracer(s);break;case"launcher":i=new Launcher(s);break;case"missile-turret":i=new MissileTurret(s);break;case"laser":i=new Laser(s);break;case"particle":i=new ParticleLauncher(s);break}if(i){i.attachParent(this);this.modules.push(i)}}}}},attachWorld:function(e){this.world=e},tick:function(e,t){for(var n=0,r=this.modules.length;n<r;n++){this.modules[n].tick(e,t)}},getData:function(e){var e=[];for(var t=0,n=this.modules.length;t<n;t++)e.push(this.modules[t].getData());return e}});Sprite=Class({constructor:function(e){this.width=toNumber(e.getAttribute("width"));this.height=toNumber(e.getAttribute("height"));this.frames=[];var t=e.getElementsByTagName("frame");for(var n=0,r=t.length;n<r;n++){this.frames.push({x:toNumber(t[n].getAttribute("x")),y:toNumber(t[n].getAttribute("y"))})}this.id=e.getAttribute("id");this.framecount=this.frames.length;this.resource=Model.loadIMG(e.getAttribute("src"))},clone:null,getData:function(){return[{name:"Properties",Width:this.width,Height:this.height,"Frame Count":this.framecount}]}});Sprite.static({Exception:Exception("Sprite"),cache:{},initialize:function(e){if(!e||!e.getElementsByTagName)throw new Sprite.Exception("Invalid XML data supplied.");var t=e.getElementsByTagName("sprite");for(var n=0,r=t.length;n<r;n++)Sprite.cache[t[n].getAttribute("id")]=new Sprite(t[n])},setSelector:function(){var e=[];var t=Model.getValue("selector");for(var n in Sprite.cache){var r=Sprite.cache[n];e.push({name:r.id,href:"#category=sprite&selector="+r.id,active:t==r.id})}Model.setValue("selector",e)}});Animated=Class({constructor:function(e,t,n){if(e instanceof Animated){this.sprite=e.sprite;this.smooth=e.smooth;this.animationSpeed=e.animationSpeed}else{this.sprite=e;this.smooth=t;this.animationSpeed=n||.1}this.framecount=this.sprite.frames.length;this.accumulator=Math.random()*this.animationSpeed;this.frame=Math.floor(Math.random()*this.framecount);this.lastFrame=this.frame},tick:function(e,t,n,r,i){this.accumulator+=e;if(this.accumulator>this.animationSpeed){this.accumulator=0;this.lastFrame=this.frame;this.frame=(this.frame+1)%this.framecount}if(this.smooth){t.render(this.sprite,n,this.lastFrame,r,i*Math.sqrt(1-this.accumulator/.1));t.render(this.sprite,n,this.frame,r,i*Math.sqrt(this.accumulator/.1))}else{t.render(this.sprite,n,this.frame,r,i)}}});Particle=Class({constructor:function(e,t,n,r,i,s,o,u,a){this.alpha=u;this.sprite=new Animated(e);this.pos=t;this.size=n;this.growth=r;this.posMod=(new Point(s,0)).rotate(i);this.rotation=o;this.maxLifespan=this.lifespan=a;this.angle=Math.random()*380},tick:function(e,t){this.lifespan-=e;if(this.lifespan<0)this.dead=true;else{this.pos=this.pos.plus(this.posMod.multiply(e));this.angle=(this.angle+this.rotation*e)%360;this.sprite.tick(e,t,1,Matrix.scale(this.size/this.sprite.sprite.width).rotate(this.angle).translate(this.pos),this.lifespan/this.maxLifespan*this.alpha);this.lifespan-=e;this.size+=this.growth*e}},attachWorld:function(e){this.world=e}});Particle.static({cache:{},initialize:function(e){var t=e.getElementsByTagName("particle");for(var n=0,r=t.length;n<r;n++){var i=t[n];Particle.cache[i.getAttribute("id")]=new Particle(i)}},get:function(e){return Particle.cache[e].clone()}});Projectile=Class(WorldObject,{constructor:function(e){WorldObject.call(this,e);if(!e.nodeName){this.id=e.id;this.name=e.name;this.pos=e.pos.clone();this.size=e.size;this.speed=e.speed;this.damage=e.damage;this.angle=e.angle;this.acceleration=e.acceleration;this.curSpeed=e.curSpeed}else{this.id=e.getAttribute("id");this.name=e.getAttribute("name")||this.id;this.pos=new Point;this.size=toNumber(e.getAttribute("size"));this.speed=toNumber(e.getAttribute("speed"));this.damage=toNumber(e.getAttribute("damage"));this.acceleration=toNumber(e.getAttribute("acceleration"));this.angle=0;if(this.acceleration)this.curSpeed=0;else this.curSpeed=this.speed}this.dead=false},set:function(e,t){this.pos=e;this.angle=t},tick:function(e,t){if(this.curSpeed!=this.speed){this.curSpeed+=this.acceleration*e;if(this.curSpeed>this.speed)this.curSpeed=this.speed}var n=t.getSize();this.pos=this.pos.plus((new Point(this.curSpeed*e,0)).rotate(this.angle));if(this.pos.x<-200||this.pos.y<-200||this.pos.x>n.x+200||this.pos.y>n.y+200)this.dead=true;WorldObject.prototype.tick.call(this,e,t)},getData:function(){var e=[{name:"Stats",Name:this.name,ID:this.id,Size:this.size,Speed:this.speed,Damage:this.damage,Acceleration:this.acceleration}];return e.concat(WorldObject.prototype.getData.call(this))}});Projectile.static({cache:{},initialize:function(e){var t=e.getElementsByTagName("projectile");for(var n=0,r=t.length;n<r;n++){var i=t[n];this.cache[i.getAttribute("id")]=new Projectile(i)}},setSelector:function(){var e=[];var t=Model.getValue("selector");for(var n in Projectile.cache){var r=Projectile.cache[n];e.push({name:r.name,href:"#category=projectile&selector="+r.id,active:t==r.id})}Model.setValue("selector",e)}});Module=Class({constructor:function(e){if(e){if(!e.nodeName){this.moduleMaxLifespan=e.moduleMaxLifespan}else{this.moduleMaxLifespan=toNumber(e.getAttribute("module-lifespan"))}this.moduleLifespan=this.moduleMaxLifespan}},tick:function(e){if(this.moduleMaxLifespan){if(this.moduleLifespan>0){this.moduleLifespan-=e}else this.dead=true}},attachParent:function(e){this.parent=e},getPos:function(){return this.parent.pos.plus(this.pos.rotate(this.parent.angle))},getData:function(){return{name:"Unknown module"}}});Sticker=Class(Module,{constructor:function(e){if(!e.nodeName){this.sprite=new Animated(e.sprite);this.pos=e.pos.clone();this.pattern=e.pattern;this.z=e.z;this.rotation=e.rotation;this.transform=e.transform.clone()}else{var t=e.getAttribute("rotation");this.sprite=new Animated(Sprite.cache[e.getAttribute("sprite")],e.getAttribute("smooth")=="true");this.pos=new Point(toNumber(e.getAttribute("x")),toNumber(e.getAttribute("y")));this.pattern=e.getAttribute("pattern");this.z=toNumber(e.getAttribute("z"));this.rotation=t=="true"||toNumber(t)||false;this.transform=Matrix.scale(toNumber(e.getAttribute("size"))/this.sprite.sprite.width)}this.angle=this.rotation?Math.random()*360:0;this.accumulator=0;this.frame=0;this.alpha=1;this.dead=true},tick:function(e,t){if(this.pattern){this.accumulator+=e;if(this.accumulator>.2){this.accumulator=0;this.frame=(this.frame+1)%this.pattern.length}if(this.pattern[this.frame]=="1")this.alpha=1;else{this.alpha-=5*e;if(this.alpha<0)this.alpha=0}}var n;if(this.rotation){this.angle=this.rotation===true?this.parent.angle:(this.angle+this.rotation*e)%360;n=Matrix.rotation(this.angle).multiply(this.transform)}else n=this.transform;n=n.translate(this.getPos());this.sprite.tick(e,t,this.z,n,this.alpha)},getData:function(){return{name:"Sticker Module",Sprite:{name:this.sprite.sprite.id,href:"#category=sprite&selector="+this.sprite.sprite.id},"Position-x":this.pos.x,"Position-y":this.pos.y,"Position-z":this.z,Pattern:this.pattern}}});Tracer=Class(Module,{constructor:function(e){if(!e.nodeName){this.pos=e.pos.clone();this.size=e.size;this.color=e.color;this.length=e.length;this.maxSpeed=e.maxSpeed;this.z=e.z}else{this.pos=new Point(parseFloat(e.getAttribute("x")),parseFloat(e.getAttribute("y")));this.size=parseFloat(e.getAttribute("size"));this.color=e.getAttribute("color").split("").map(function(e){return Math.pow(parseInt("0x"+e),2)}).join(",");this.length=toNumber(e.getAttribute("length"));this.maxSpeed=toNumber(e.getAttribute("max-speed"));this.z=toNumber(e.getAttribute("z"))}this.trace=[];this.accumulator=0},tick:function(e,t){var n=this.getPos();this.accumulator+=e;if(this.accumulator>.02){if(!this.trace.length){this.trace.push({pos:n,speed:0})}this.trace.push({pos:n,speed:this.trace[this.trace.length-1].pos.minus(n).length()/this.accumulator});if(this.trace.length>this.length)this.trace.shift();this.accumulator=0}if(this.trace.length){var r=[];for(var i=1,s=this.trace.length;i<s;i++){var o=this.trace[i];var u=this.trace[i-1];var a=(u.speed/this.maxSpeed*1.5-.5)*(i/this.length);if(a<0)a=0;r.push({alpha:a,start:u.pos,end:o.pos})}r.width=this.size;r.color="rgb("+this.color+")";t.draw(this.z,r)}},getData:function(){return{name:"Tracer Module","Position-x":this.pos.x,"Position-y":this.pos.y,Color:this.color,"Speed Treshold":this.maxSpeed,Length:this.length}}});Launcher=Class(Module,{constructor:function(e){if(e){if(!e.nodeName){this.projectile=e.projectile;this.pos=e.pos;this.speed=e.speed;this.spinup=e.spinup;this.heatPerShot=e.heatPerShot;this.cooldown=e.cooldown;this.spread=e.spread;this.regular=e.regular;this.spreadCurve=e.spreadCurve;this.pelletCount=e.pelletCount}else{this.projectile=Projectile.cache[e.getAttribute("projectile")];this.pos=new Point(toNumber(e.getAttribute("x")),toNumber(e.getAttribute("y")));this.speed=toNumber(e.getAttribute("speed"));this.spinup=toNumber(e.getAttribute("spinup"));this.heatPerShot=toNumber(e.getAttribute("heat-per-shot"));this.cooldown=toNumber(e.getAttribute("cooldown"));this.spread=toNumber(e.getAttribute("spread"));this.regular=e.getAttribute("regular")=="true";this.spreadCurve=toNumber(e.getAttribute("spread-curve"));this.pelletCount=toNumber(e.getAttribute("pellet-count"))||1}}this.overheated=false;this.heat=0;this.currentCooldown=0},tick:function(e,t){this.currentCooldown-=e;if(this.currentCooldown<0)this.currentCooldown=0;if(!this.overheated){if(!this.currentCooldown){var n=(this.spreadCurve?Math.pow(this.heat/10,this.spreadCurve):1)*this.spread;for(var r=0;r<this.pelletCount;r++){var i=this.getAngle()+((this.regular?r/(this.pelletCount-1):Math.random())-.5)*n;var s=this.projectile.clone();s.set(this.getPos(),i);this.parent.world.push(s)}this.heat+=this.heatPerShot;this.currentCooldown=this.speed+(this.spinup?(1-confine(this.heat,0,1)/1)*this.spinup:0);if(this.heat>=10){this.overheated=true;this.currentCooldown=this.cooldown}}}else{if(!this.currentCooldown){this.heat=0;this.overheated=false}}},getAngle:function(){return this.parent.angle},getData:function(){return{name:"Projectile Launcher Module",Projectile:{name:this.projectile.name,href:"#category=projectile&selector="+this.projectile.id},"Position-x":this.pos.x,"Position-y":this.pos.y,"Weapon Speed":this.speed,"Heat Per Shot":this.heatPerShot,Cooldown:this.cooldown,Spread:this.spread,"Spread-curve":this.spreadCurve,Spinup:this.spinup}}});MissileTurret=Class(Launcher,{constructor:function(e){if(e.nodeName){this.sprite=new Animated(Sprite.cache[e.getAttribute("sprite")]);this.turnSpeed=toNumber(e.getAttribute("turn-speed"));this.offset=new Point(toNumber(e.getAttribute("offset-x")),toNumber(e.getAttribute("offset-y")));this.size=toNumber(e.getAttribute("size"))}else{this.sprite=e.sprite;this.turnSpeed=e.turnSpeed;this.offset=e.offset.clone();this.size=e.size}Launcher.call(this,e);this.angle=null},tick:function(e,t){if(this.angle===null)this.angle=this.parent.angle;var n=Model.cursor.minus(this.getPos()).getAngle();if(this.turnSpeed){var r=this.turnSpeed*e;var i=angularDiff(n,this.angle);if(Math.abs(i)<r)this.angle=n;else this.angle=angularDiff(this.angle+sgn(i)*r,0)}else this.angle=n;var s=Matrix.scale(this.size/this.sprite.sprite.width).translate(this.offset).rotate(this.getAngle()).translate(this.getPos());this.sprite.tick(e,t,7,s,1);Launcher.prototype.tick.call(this,e,t)},getAngle:function(){return this.angle},getData:function(){var e=Launcher.prototype.getData.call(this);e.name="Missile Turret Module";e["Sprite"]={name:this.sprite.sprite.id,href:"#category=sprite&selector="+this.sprite.sprite.id};e["Offset-x"]=this.offset.x;e["Offset-y"]=this.offset.y;e["Turn Speed"]=this.turnSpeed;e["Size"]=this.size;return e}});ParticleLauncher=Class(Module,{constructor:function(e){Module.call(this,e);if(!e.nodeName){this.sprite=e.sprite;this.pos=e.pos.clone();this.angle=e.angle;this.size=e.size;this.growth=e.growth;this.launchSpeed=e.launchSpeed;this.spread=e.spread;this.minSpeed=e.minSpeed;this.maxSpeed=e.maxSpeed;this.rotation=e.rotation;this.alpha=e.alpha;this.lifespan=e.lifespan}else{this.sprite=Sprite.cache[e.getAttribute("sprite")];this.pos=new Point(toNumber(e.getAttribute("x")),toNumber(e.getAttribute("y")));this.angle=toNumber(e.getAttribute("angle"));this.size=toNumber(e.getAttribute("size"));this.growth=toNumber(e.getAttribute("growth"));this.launchSpeed=toNumber(e.getAttribute("launch-speed"));this.spread=toNumber(e.getAttribute("spread"));this.minSpeed=toNumber(e.getAttribute("min-speed"));this.maxSpeed=toNumber(e.getAttribute("max-speed"));this.rotation=toNumber(e.getAttribute("rotation"));this.alpha=toNumber(e.getAttribute("alpha"))||1;this.lifespan=toNumber(e.getAttribute("lifespan"))}this.accumulator=0;this.dead=false},tick:function(e){if(!this.dead){while(this.accumulator>this.launchSpeed){this.accumulator-=this.launchSpeed;var t=this.angle+this.parent.angle+(Math.random()-.5)*this.spread;var n=this.getPos();var r=(this.maxSpeed-this.minSpeed)*Math.random()+this.minSpeed;var i=(this.moduleMaxLifespan?this.moduleLifespan/this.moduleMaxLifespan:1)*this.lifespan;this.parent.world.push(new Particle(this.sprite,n,this.size,this.growth,t,r,this.rotation,this.alpha,i))}this.accumulator+=e;Module.prototype.tick.call(this,e)}},getData:function(){return{name:"Particle Launcher Module","Projectile Sprite":{name:this.sprite.id,href:"#category=sprite&selector="+this.sprite.id},"Position-x":this.pos.x,"Position-y":this.pos.y,"Particle Size":this.size,"Particle Growth":this.growth,"Launch Speed":this.launchSpeed,"Cone Of Fire":this.spread,"Min Speed":this.minSpeed,"Max Speed":this.maxSpeed,"Particle Rotation":this.rotation,"Particle Base Alpha":this.alpha,"Particle Lifespan":this.lifespan}}});Laser=Class(Module,{constructor:function(e){if(e.nodeName){this.charge=Sprite.cache[e.getAttribute("charge")];this.beam=Sprite.cache[e.getAttribute("beam")];this.pos=new Point(toNumber(e.getAttribute("x")),toNumber(e.getAttribute("y")));this.size=toNumber(e.getAttribute("size"));this.cooldown=toNumber(e.getAttribute("cooldown"));this.heatPerSecond=toNumber(e.getAttribute("heat-per-second"))}else{this.charge=e.charge;this.beam=e.beam;this.pos=e.pos.clone();this.size=e.size;this.cooldown=e.cooldown;this.heatPerSecond=e.heatPerSecond}this.overheated=false;this.heat=0},tick:function(e,t){if(!this.overheated){if(this.heat<10){var n=Matrix.scale2(2e3/this.beam.width,this.size/this.beam.height).translate2(1e3,0).rotate(this.parent.angle).translate(this.getPos());t.render(this.beam,4,0,n,1);this.heat+=e*this.heatPerSecond}else{this.overheated=true;this.heat=this.cooldown}}else{if(this.heat>0){if(this.heat<3){var n=Matrix.scale2(2e3/this.charge.width,this.size/this.charge.height).translate2(1e3,0).rotate(this.parent.angle).translate(this.getPos());t.render(this.charge,4,0,n,.7)}this.heat-=e}else{this.heat=0;this.overheated=false}}}});Ship=Class(WorldObject,{constructor:function(e){WorldObject.call(this,e);if(!e.nodeName){this.id=e.id;this.name=e.name;this.desc=e.desc;this.size=e.size;this.speed=e.speed;this.turnSpeed=e.turnSpeed;this.health=e.health}else{this.id=e.getAttribute("id");this.name=e.getAttribute("name")||this.id;this.desc=e.getAttribute("desc");this.size=toNumber(e.getAttribute("size"));this.speed=toNumber(e.getAttribute("speed"));this.turnSpeed=toNumber(e.getAttribute("turn-speed"));this.health=toNumber(e.getAttribute("health"))}this.targetAngle=0;this.shoot=false;this.angle=-90;this.pos=new Point(250,250)},set:function(e,t){this.pos=e.clone();this.angle=t},control:function(e,t,n){this.direction=e;this.shoot=n;this.targetAngle=t},tick:function(e,t){if(this.direction){if(this.turnSpeed){var n=this.turnSpeed*e;var r=angularDiff(this.targetAngle,this.angle);if(Math.abs(r)<n)this.angle=this.targetAngle;else this.angle=angularDiff(this.angle+sgn(r)*n,0)}else this.angle=this.targetAngle;var i=t.getSize();var s=this.pos.plus(this.direction.multiply(this.speed*e));this.pos.set(confine(s.x,0,i.x),confine(s.y,0,i.y))}else{this.angle=(this.angle+this.turnSpeed*e)%360;this.pos.x=250+100*sin(this.angle)}WorldObject.prototype.tick.call(this,e,t)},getData:function(){return[{name:"Description",Name:this.name,ID:this.id,desc:this.desc||"No description available"},{name:"Ship Statistics",Size:this.size,Speed:this.speed,"Turn Speed":this.turnSpeed,Health:this.health}].concat(WorldObject.prototype.getData.call(this))}});Ship.static({cache:{},initialize:function(e){var t=e.getElementsByTagName("ship");for(var n=0,r=t.length;n<r;n++)var i=Ship.cache[t[n].getAttribute("id")]=new Ship(t[n])},setSelector:function(){var e=[];var t=Model.getValue("selector");for(var n in Ship.cache){var r=Ship.cache[n];e.push({name:r.name,href:"#category=ship&selector="+r.id,active:t==r.id})}Model.setValue("selector",e)}});Application=Class({constructor:function(){try{var e=Model.loadXML("data/data.xml?t="+Date.now());var t=this;Sprite.initialize(e);Projectile.initialize(e);Ship.initialize(e);this.world=new World;this.background=Sprite.cache["sprite-background"];this.backgroundAlpha=0;this.renderTarget=new RenderTarget("canvas",10);this.renderTarget.onClick(function(){t.nextSpriteFrame()});Ship.setSelector()}catch(n){if(n instanceof Model.Exception)throw new Application.Exception(n)}},tick:function(e){if(window.location.href!=this.url){this.url=window.location.href;this.onUrlChange()}this.updateSelected(e);var t=this.renderTarget.getSize();var n=this.ship?this.ship.pos.multiply(.1).minus(new Point(200,200)):new Point(0,0);this.renderTarget.render(this.background,0,0,Matrix.translation(t.multiply(.5).plus(n)),this.backgroundAlpha);this.renderTarget.render(Sprite.cache["sprite-data-viewer"],0,0,Matrix.translation2(t.x-450,100),.8);this.renderTarget.render(Sprite.cache["sprite-wrona"],0,0,Matrix.scale(.5).translate2(t.x-380,170),.8);this.world.tick(e,this.renderTarget);this.renderTarget.swap()},main:function(e){var t=this;var n=Date.now();var r=setInterval(function(){var i=Date.now();if(i-n>=e){var s=(i-n)/1e3;n=i;try{t.tick(s)}catch(o){clearInterval(r);throw new Application.Exception("Runtime Error: "+o)}}},1)},nextSpriteFrame:function(){if(this.sprite)this.spriteFrame=(this.spriteFrame+1)%this.sprite.framecount},updateSelected:function(e){if(this.accumulator<1)this.accumulator+=e;else this.accumulator=0;if(this.ship){var t=this.ship?this.renderTarget.getCursor().minus(this.ship.pos).getAngle():-90;var n=new Point(KeyMap["right"]-KeyMap["left"],KeyMap["down"]-KeyMap["up"]);this.ship.control(n.normalize(),t,KeyMap["shoot"]);this.shipCursor()}else if(this.projectile){if(!this.accumulator){var r=this.projectile.clone();r.set(new Point(300,150),45);this.world.push(r)}}else if(this.sprite){this.zoom=this.zoom*=1+(KeyMap["zoomIn"]-KeyMap["zoomOut"])*e;this.renderTarget.render(this.sprite,2,this.spriteFrame,Matrix.scale(this.zoom).translate(this.renderTarget.getSize().multiply(.5)),1)}this.backgroundAlpha=confine(this.backgroundAlpha+(this.sprite?-1:1)*e,0,1)},onUrlChange:function(){if(this.ship){this.ship.dead=true;this.ship=null}this.sprite=null;this.projectile=null;var e=Model.getValue("selector");switch(Model.getValue("category")){case"sprite":Sprite.setSelector();this.zoom=1;this.spriteFrame=0;this.sprite=Sprite.cache[Model.getValue("selector")]||Sprite.cache["font-basic"];Model.setData(this.sprite.getData());break;case"projectile":Projectile.setSelector();this.projectile=Projectile.cache[e]||Projectile.cache["missile"];Model.setData(this.projectile.getData());this.accumulator=1;break;default:Ship.setSelector();if(Ship.cache[e])this.ship=Ship.cache[e].clone();else this.ship=Ship.cache["main"].clone();this.ship.pos=this.renderTarget.getSize().multiply(.5);this.world.push(this.ship);Model.setData(this.ship.getData());this.ship.angle=this.renderTarget.getCursor().minus(this.ship.pos).getAngle();break}},shipCursor:function(){var e=this.ship.size;var t=e/2;var n=this.renderTarget.getSize();var r=.8;this.renderTarget.draw(9,[{start:new Point(this.ship.pos.x,0),end:new Point(this.ship.pos.x,this.ship.pos.y-t),alpha:r}]);this.renderTarget.draw(9,[{start:new Point(this.ship.pos.x,this.ship.pos.y+t),end:new Point(this.ship.pos.x,n.y),alpha:r}]);this.renderTarget.draw(9,[{start:new Point(0,this.ship.pos.y),end:new Point(this.ship.pos.x-t,this.ship.pos.y),alpha:r}]);this.renderTarget.draw(9,[{start:new Point(this.ship.pos.x+t,this.ship.pos.y),end:new Point(n.x,this.ship.pos.y),alpha:r}]);this.renderTarget.draw(9,[{start:new Point(this.ship.pos.x+t,this.ship.pos.y),end:new Point(n.x,this.ship.pos.y),alpha:r}]);this.renderTarget.draw(9,[{start:new Point(this.ship.pos.x-t,this.ship.pos.y-t),end:new Point(this.ship.pos.x-t,this.ship.pos.y+t),alpha:r},{start:new Point(this.ship.pos.x-t,this.ship.pos.y+t),end:new Point(this.ship.pos.x+t,this.ship.pos.y+t),alpha:r},{start:new Point(this.ship.pos.x+t,this.ship.pos.y+t),end:new Point(this.ship.pos.x+t,this.ship.pos.y-t),alpha:r},{start:new Point(this.ship.pos.x+t,this.ship.pos.y-t),end:new Point(this.ship.pos.x-t,this.ship.pos.y-t),alpha:r}])}});Application.static({Exception:Exception("Application")});Model.onLoad(function(){var e;try{e=new Application}catch(t){console.log(Application.Exception);if(t instanceof Application.Exception){Model.errorBox(t);return}else throw t}e.main(8)});</script></head><body><div id="resources"></div><div id="error-box"></div><div id="categories"><a class="home" href="..">LAYV.NET</a><a href="#category=ship">Ships</a><a href="#category=projectile">Projectiles</a><a href="#category=sprite">Sprites</a></div><div id="selector"></div><canvas id="canvas" width="500" height="500"></canvas><div id="data"></div><div id="foot">WSAD - move ship. Numpad plus/minus sprite zoom in/out. Click - next animation frame. ©2014&nbsp;Łukasz&nbsp;A.J.&nbsp;Wrona</div></body></html>
